<!DOCTYPE>
<html>
    <head>
        <title>Leil√µes SIRS</title>
        <link rel="stylesheet" href="Homepage.css">
    </head>
    <body>
        <div id="title">
            <p id="auctions"> <b> Auctions </b></p>
        </div>
        
        <div id=placebid>
            <p id="placeyourbid"> <b>Place your Bid! </b></p>
            
            <label for="id">Auction ID:</label>
            <input type="text" onkeypress='return event.charCode >= 48 && event.charCode <= 57' id="bidid" align="right" name="bidid">
            
            <label for="bid">Your Bid:</label>
            <input type="text" onkeypress='return event.charCode >= 48 && event.charCode <= 57' id="bidvalue" align="right" name="bidvalue">
        </div>
        
        <script> 
            var url = "https://localhost:9000/AuctionServer/Auction";
            var xmlhttp = new XMLHttpRequest();
            var message;
            var i;
            
            xmlhttp.open("GET", url, true);
            xmlhttp.send();
            xmlhttp.onreadystatechange = function() {
                if(xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    message = JSON.parse(xmlhttp.responseText);
                    var autions =message.auctions;
                    for ( i=0;i< autions.length;i++) {
                        var newElement = document.createElement('div');
                        newElement.id = i;
                        newElement.className = "leilao";
                        newElement.innerHTML = 'Name: ' + message.auctions[i].name + '<br>' + 'Current Bid: ' + message.auctions[i].highestBid + '<br>' + 'Expiration Date: ' + message.auctions[i].data + '<br>' + 'Auction ID: ' +message.auctions[i].id + '<br>';
                        document.body.appendChild(newElement);
                    }
                   
                }
                else if(xmlhttp.readyState == 4 && xmlhttp.status == 5) {
                    //bid lower than the current one - error code 5
                    window.alert("Your bid is lower than the current highest bid!");
                }
                else if(xmlhttp.readyState == 4)
                    window.alert("Something went wrong! Error:" + xmlhttp.status);
                //else not success
            };
            
            function submit(id) {
                var bid = document.getElementById("bid").value;
                var url = "https://localhost:9000/AuctionServer/Auction/bid";
                var xmlhttp = new XMLHttpRequest();
                
                //parsing timestamp. its a bit noob, might be changed if we have time
                var timeddmmyy = (new Date()).toString().split(" ");
                var timehhminss = timeddmmyy[4].split(":");
                var dd = timeddmmyy[2];
                var mo = timeddmmyy[1];
                var yy = timeddmmyy[3];
                var hh = timehhminss[0];
                var min = timehhminss[1];
                var ss = timehhminss[2];

                xmlhttp.open("POST", url, true);
                xmlhttp.setRequestHeader("Content-Type", "application/json");
                xmlhttp.send(JSON.stringify({id:id, bid:bid, day:dd, month:mo, year:yy, hours:hh, minutes:min, seconds:ss}));
                xmlhttp.onreadystatechange = function() {
                    if(xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                        window.location.reload();
                    }
                    else if(xmlhttp.readyState == 4 && xmlhttp.status == 5) {
                        //bid lower than the current one - error code 5
                        window.alert("Your bid is lower than the current highest bid!");
                    }
                    else window.alert("Something went wrong! Error:" + xmlhttp.status);
                    //else not success
                };
            }
            
        </script>

    </body>
</html>